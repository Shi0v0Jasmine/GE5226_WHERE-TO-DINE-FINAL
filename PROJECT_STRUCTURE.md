# Where to DINE - 项目结构图

## 项目概述
**Where to DINE** 是一个基于地理位置的餐厅推荐系统，允许用户在地图上选择起点，然后根据出行方式和时间找到推荐的餐厅热点区域。

---

## 系统架构

```
┌─────────────────────────────────────────────────────────────┐
│                    Where to DINE System                      │
└─────────────────────────────────────────────────────────────┘
                           │
        ┌──────────────────┴──────────────────┐
        │                                     │
        ▼                                     ▼
┌───────────────┐                    ┌───────────────┐
│   前端层       │                    │   后端层       │
│  (Frontend)   │ ◄────HTTP────►     │  (Backend)    │
└───────────────┘                    └───────────────┘
        │                                     │
        │                                     │
        ▼                                     ▼
┌───────────────┐                    ┌───────────────┐
│  第三方API     │                    │   数据层       │
│ (Mapbox API)  │                    │  (Database)   │
└───────────────┘                    └───────────────┘
```

---

## 项目文件结构

```
GE5226_WHERE-TO-DINE-FINAL/
│
├── .git/                                    # Git版本控制目录
│
├── where-to-dine-front-end.html            # 前端主文件（已删除）
│   └── 功能：
│       ├── 交互式地图界面（Leaflet）
│       ├── 用户输入控制面板
│       ├── 等时圈可视化
│       └── 推荐餐厅列表展示
│
└── [后端文件] (未在仓库中)
    ├── main.py / app.py                    # 后端API服务器（推测）
    │   └── API端点：
    │       ├── /api/hotspots               # 获取所有热点区域
    │       └── /api/recommend              # 获取推荐餐厅
    │
    └── [数据文件]                           # 餐厅和热点数据（推测）
```

---

## 技术栈详情

### 前端技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| **HTML5** | - | 页面结构 |
| **CSS3** | - | 样式设计（深色主题） |
| **JavaScript** | ES6+ | 交互逻辑 |
| **Leaflet.js** | 1.9.4 | 地图渲染和交互 |
| **Bootstrap** | 5.3.3 | UI组件和响应式布局 |
| **Bootstrap Icons** | 1.11.3 | 图标库 |

### 后端技术栈（推测）

| 技术 | 用途 |
|------|------|
| **Python** | 后端开发语言 |
| **FastAPI/Flask** | Web框架（根据端口8000推测） |
| **GeoJSON** | 地理数据格式 |

### 第三方服务

| 服务 | 用途 |
|------|------|
| **Mapbox Isochrone API** | 生成等时圈（可达范围） |
| **CartoDB Dark Matter** | 地图底图瓦片服务 |

---

## 核心功能模块

### 1. 地图交互模块
```
┌─────────────────────────────────┐
│      地图交互 (Map Module)       │
├─────────────────────────────────┤
│ • 地图初始化（Leaflet）          │
│ • 点击设置起点                   │
│ • 图层管理：                     │
│   - hotspotsLayer (热点背景)     │
│   - isoLayer (等时圈)            │
│   - recommendedLayer (推荐点)    │
│   - markerLayer (用户标记)       │
└─────────────────────────────────┘
```

### 2. 用户控制模块
```
┌─────────────────────────────────┐
│    控制面板 (Control Panel)      │
├─────────────────────────────────┤
│ • 出行方式选择：                 │
│   - 步行 (walking)               │
│   - 驾车 (driving)               │
│ • 时间范围滑块：5-60分钟         │
│ • 搜索按钮                       │
└─────────────────────────────────┘
```

### 3. 数据处理模块
```
┌─────────────────────────────────┐
│   数据处理 (Data Processing)     │
├─────────────────────────────────┤
│ • 加载所有热点区域               │
│ • 获取Mapbox等时圈数据           │
│ • 请求后端推荐算法               │
│ • GeoJSON数据解析                │
│ • 结果排序（按加权评分）         │
└─────────────────────────────────┘
```

### 4. 结果展示模块
```
┌─────────────────────────────────┐
│   结果展示 (Results Display)     │
├─────────────────────────────────┤
│ • 侧边栏列表展示：               │
│   - 餐厅名称                     │
│   - 区域 (Zone)                  │
│   - 加权评分                     │
│ • 地图标记展示：                 │
│   - 圆形标记（黄色）             │
│   - 弹出信息框                   │
│ • 点击列表项跳转到地图位置       │
└─────────────────────────────────┘
```

---

## 数据流图

```
用户操作
  │
  ├─ 1. 点击地图设置起点
  │     └─► 在 markerLayer 创建标记
  │
  ├─ 2. 选择出行方式 & 时间
  │     └─► 更新控制面板状态
  │
  └─ 3. 点击"查找推荐"按钮
        │
        ├─► API调用1: Mapbox Isochrone API
        │   └─► 返回等时圈 GeoJSON
        │       └─► 渲染到 isoLayer
        │
        └─► API调用2: 后端 /api/recommend
            ├─ 参数: lat, lon, mode, minutes
            │
            └─► 返回推荐餐厅 GeoJSON
                ├─► 渲染到地图 (recommendedLayer)
                └─► 渲染到侧边栏列表 (results-list)
```

---

## API接口规范

### 后端API端点

#### 1. 获取所有热点区域
```
GET /api/hotspots
Response: GeoJSON字符串
{
  "type": "FeatureCollection",
  "features": [...]
}
```

#### 2. 获取推荐餐厅
```
GET /api/recommend?lat={lat}&lon={lon}&mode={mode}&minutes={minutes}
参数：
  - lat: 纬度
  - lon: 经度
  - mode: 出行方式 (walking/driving)
  - minutes: 时间范围 (5-60)

Response: GeoJSON字符串
{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [lon, lat]
      },
      "properties": {
        "name": "餐厅名称",
        "address": "地址",
        "zone": "区域",
        "weighted_score": 分数
      }
    },
    ...
  ]
}
```

---

## UI设计规范

### 配色方案
- **主背景**: `#1a1a1a` (深黑色)
- **侧边栏**: `#212529` (深灰色)
- **卡片背景**: `#343a40` (中灰色)
- **列表项**: `#495057` (浅灰色)
- **列表悬停**: `#6c757d` (更浅灰色)
- **主题色**: `#ffc107` (黄色 - 用于标题和标记)
- **文字**: `#f8f9fa` (浅色文字)

### 布局结构
```
┌──────────────────────────────────────────────┐
│                 100vh                         │
├─────────────┬────────────────────────────────┤
│             │                                 │
│  Sidebar    │        Map Container           │
│  (30%宽度)  │        (剩余空间)                │
│  最大400px  │                                 │
│  最小300px  │        Leaflet Map             │
│             │        (100%宽高)               │
│  ┌────────┐│                                 │
│  │控制面板 ││                                 │
│  └────────┘│                                 │
│  ┌────────┐│                                 │
│  │推荐列表 ││                                 │
│  └────────┘│                                 │
│             │                                 │
└─────────────┴────────────────────────────────┘
```

---

## 关键特性

1. **响应式设计**: 使用Flexbox布局，适配不同屏幕尺寸
2. **深色主题**: 现代化的深色UI界面
3. **实时交互**: 地图点击即时反馈，列表点击跳转地图
4. **等时圈可视化**: 直观显示可达范围
5. **智能推荐**: 基于加权评分的餐厅排序
6. **双重展示**: 地图标记 + 侧边栏列表

---

## 技术亮点

1. **DOM加载优化**: 使用`DOMContentLoaded`确保脚本在DOM加载后执行
2. **地图渲染修复**: 使用`invalidateSize()`解决Flexbox中Leaflet空白问题
3. **图层管理**: 使用多个`LayerGroup`实现清晰的图层分离
4. **异步数据处理**: 使用`async/await`处理API调用
5. **错误处理**: 完善的try-catch错误捕获机制

---

## 部署要求

### 前端部署
- 任何静态Web服务器（如Nginx、Apache）
- 或直接通过浏览器打开HTML文件

### 后端部署
- Python 3.7+
- 后端服务器需运行在 `http://127.0.0.1:8000`

### 环境变量
- **MAPBOX_TOKEN**: 需要有效的Mapbox访问令牌

---

## 开发状态

### Git历史
```
cb3cffd - Delete where-to-dine-front-end.html (当前HEAD)
aad7641 - Add files via upload
```

### 当前状态
- 前端HTML文件已被删除
- 项目处于空白状态
- 后端文件不在版本控制中

---

## 建议的项目完整结构

```
GE5226_WHERE-TO-DINE-FINAL/
│
├── frontend/
│   ├── index.html                  # 前端主文件
│   ├── css/
│   │   └── style.css               # 独立样式文件
│   └── js/
│       └── app.js                  # 独立JavaScript文件
│
├── backend/
│   ├── main.py                     # FastAPI/Flask服务器
│   ├── requirements.txt            # Python依赖
│   ├── models/
│   │   └── recommendation.py       # 推荐算法模型
│   └── data/
│       ├── hotspots.geojson        # 热点区域数据
│       └── restaurants.geojson     # 餐厅数据
│
├── .gitignore                      # Git忽略规则
├── README.md                       # 项目说明文档
└── PROJECT_STRUCTURE.md            # 本结构文档
```

---

**文档生成时间**: 2025-11-16
**项目状态**: 需要恢复文件并完善后端代码
